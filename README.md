# 商品缓存与库存管理系统

基于Java、Spring Boot、Redis和MySQL的商品缓存、库存扣减和订单处理系统。

## 系统架构

本系统由以下几个核心功能模块组成：

1. **商品缓存模块**：负责商品数据的缓存管理
2. **库存管理模块**：处理商品库存的扣减与回滚
3. **订单处理模块**：处理订单创建、支付与取消
4. **库存同步模块**：定期同步Redis与MySQL中的库存数据

## 主要功能

### 商品缓存流程

1. 用户请求商品信息
2. 先检查Redis缓存
3. 缓存存在：直接返回数据
4. 缓存不存在：查询数据库
5. 将结果写入Redis缓存（设置TTL）
6. 返回商品数据

### 库存扣减流程

1. 用户提交订单请求
2. 检查Redis库存
3. 库存充足：执行Lua脚本原子扣减
4. 创建订单（状态=待支付）
5. 发送库存扣减MQ消息
6. 库存不足：直接返回错误

### 订单处理流程

1. 订单创建后进入待支付状态
2. 启动5分钟支付倒计时
3. 用户支付成功：确认库存扣减
4. 支付超时：取消订单
5. 库存回滚（Redis+数据库）

### 库存同步机制

系统通过定时任务定期检查和修复Redis与MySQL中的库存不一致问题：

1. 每10分钟执行一次库存同步任务
2. 对比Redis与MySQL中的库存数据
3. 发现不一致时，以MySQL为准进行修复
4. 记录所有同步操作日志

## 技术栈

- Java 17
- Spring Boot 3.5.3
- Spring Data Redis
- Spring Data JPA
- MySQL
- RabbitMQ
- Redis

## 关键设计特点

1. **高并发处理**：使用Redis和Lua脚本实现原子化库存操作
2. **数据一致性**：通过定时任务确保Redis和MySQL库存数据一致
3. **异步处理**：使用RabbitMQ实现数据库操作异步化
4. **失败恢复**：支持库存回滚和订单超时自动取消
5. **实时性**：使用Redis缓存提供实时的商品和库存信息 